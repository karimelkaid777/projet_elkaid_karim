<div class="signup-container">
  <div class="signup-card">
    <div class="signup-header">
      <h2>Créer un compte</h2>
      <p class="subtitle">Rejoignez la communauté pour signaler des pollutions</p>
    </div>

    <form (ngSubmit)="onSubmit()" class="signup-form">
      <!-- Section : Identité -->
      <fieldset class="form-section">
        <legend>Identité</legend>
        <div class="form-row">
          <div class="form-group">
            <label for="prenom">Prénom</label>
            <input
              type="text"
              id="prenom"
              [value]="prenom()"
              (input)="prenom.set($any($event.target).value)"
              (blur)="onPrenomBlur()"
              [class.error]="isFieldTouched('prenom') && validationErrors()['prenom']"
              [class.valid]="isFieldTouched('prenom') && prenom() && !validationErrors()['prenom']"
              placeholder="Jean"
            />
            @if (isFieldTouched('prenom') && validationErrors()['prenom']) {
              <div class="field-error">{{ validationErrors()['prenom'] }}</div>
            }
          </div>

          <div class="form-group">
            <label for="nom">Nom</label>
            <input
              type="text"
              id="nom"
              [value]="nom()"
              (input)="nom.set($any($event.target).value)"
              (blur)="onNomBlur()"
              [class.error]="isFieldTouched('nom') && validationErrors()['nom']"
              [class.valid]="isFieldTouched('nom') && nom() && !validationErrors()['nom']"
              placeholder="Dupont"
            />
            @if (isFieldTouched('nom') && validationErrors()['nom']) {
              <div class="field-error">{{ validationErrors()['nom'] }}</div>
            }
          </div>
        </div>
      </fieldset>

      <!-- Section : Contact -->
      <fieldset class="form-section">
        <legend>Contact</legend>
        <div class="form-group">
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            [value]="email()"
            (input)="email.set($any($event.target).value)"
            (blur)="onEmailBlur()"
            [class.error]="isFieldTouched('email') && validationErrors()['email']"
            [class.valid]="isFieldTouched('email') && email() && !validationErrors()['email']"
            placeholder="jean.dupont@exemple.com"
          />
          @if (isFieldTouched('email') && validationErrors()['email']) {
            <div class="field-error">{{ validationErrors()['email'] }}</div>
          }
        </div>
      </fieldset>

      <!-- Section : Identifiants -->
      <fieldset class="form-section">
        <legend>Identifiants de connexion</legend>
        <div class="form-group">
          <label for="login">Login</label>
          <input
            type="text"
            id="login"
            [value]="login()"
            (input)="login.set($any($event.target).value)"
            (blur)="onLoginBlur()"
            [class.error]="isFieldTouched('login') && validationErrors()['login']"
            [class.valid]="isFieldTouched('login') && login() && !validationErrors()['login']"
            placeholder="jean_dupont"
          />
          @if (isFieldTouched('login') && validationErrors()['login']) {
            <div class="field-error">{{ validationErrors()['login'] }}</div>
          } @else {
            <div class="field-hint">{{ fieldHints['login'] }}</div>
          }
        </div>

        <div class="form-group">
          <label for="password">Mot de passe</label>
          <input
            type="password"
            id="password"
            [value]="password()"
            (input)="password.set($any($event.target).value)"
            (blur)="onPasswordBlur()"
            [class.error]="isFieldTouched('pass') && validationErrors()['pass']"
            [class.valid]="isFieldTouched('pass') && password() && !validationErrors()['pass']"
            placeholder="Votre mot de passe"
          />
          @if (isFieldTouched('pass') && validationErrors()['pass']) {
            <div class="field-error">{{ validationErrors()['pass'] }}</div>
          } @else if (isFieldTouched('pass') && password() && !validationErrors()['pass']) {
            <div class="field-success">Mot de passe sécurisé</div>
          } @else {
            <div class="field-hint">{{ fieldHints['pass'] }}</div>
          }
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirmation</label>
          <input
            type="password"
            id="confirmPassword"
            [value]="confirmPassword()"
            (input)="confirmPassword.set($any($event.target).value)"
            (blur)="onConfirmPasswordBlur()"
            [class.error]="isFieldTouched('confirmPassword') && validationErrors()['confirmPassword']"
            [class.valid]="isFieldTouched('confirmPassword') && confirmPassword() && !validationErrors()['confirmPassword'] && password() === confirmPassword()"
            placeholder="Confirmez le mot de passe"
          />
          @if (isFieldTouched('confirmPassword') && validationErrors()['confirmPassword']) {
            <div class="field-error">{{ validationErrors()['confirmPassword'] }}</div>
          }
        </div>
      </fieldset>

      @if (error()) {
        <div class="error-message">{{ error() }}</div>
      }

      @if (success()) {
        <div class="success-message">Compte créé avec succès ! Redirection...</div>
      }

      <button
        type="submit"
        appLoadingButton
        [loading]="loading()"
        [disabled]="loading() || success()">
        Créer mon compte
      </button>
    </form>

    <div class="login-link">
      <p>Vous avez déjà un compte ? <a routerLink="/users/login">Se connecter</a></p>
    </div>
  </div>
</div>
