<div class="list-container">
  <div class="page-header">
    <h2>Liste des pollutions</h2>
    <a routerLink="/pollutions/new" class="btn-create">
      <span class="btn-icon">+</span> Signaler une pollution
    </a>
  </div>

  <div class="filters">
    <div class="filter-group">
      <label>Recherche :</label>
      <input
        type="text"
        [ngModel]="filterTitle()"
        (ngModelChange)="handleSearchTextChange($event)"
        placeholder="Rechercher par titre..."
      >
    </div>

    <div class="filter-group">
      <label>Type :</label>
      <select [ngModel]="filterType()" (ngModelChange)="handlePollutionTypeChange($event)">
        <option value="">Tous</option>
        @for (type of pollutionTypes; track type) {
          <option [value]="type">{{ type }}</option>
        }
      </select>
    </div>
  </div>

  @if (loading()) {
    <div class="loading">Chargement en cours...</div>
  }

  @if (error()) {
    <div class="error">{{ error() }}</div>
  }

  @if (!loading() && !error()) {
    <div class="pollution-grid">
      @for (pollution of pollutions(); track pollution.id) {
        <a [routerLink]="['/pollutions/detail', pollution.id]" class="pollution-card">
          <div class="card-header">
            <span class="type-icon">{{ getTypeIcon(pollution.type) }}</span>
            <span class="type-badge">{{ pollution.type }}</span>
          </div>

          <h3>{{ pollution.title }}</h3>
          <p class="location">üìç {{ pollution.location }}</p>
          <p class="date">üìÖ {{ formatDate(pollution.dateObservation) }}</p>

          <div class="card-actions">
            <button
              appLoadingButton
              [loading]="favoriteLoadingId() === pollution.id"
              class="btn-favorite"
              [class.is-favorite]="isFavorite()(pollution.id)"
              [class.requires-login]="!isAuthenticated()"
              [title]="!isAuthenticated() ? 'Connectez-vous pour ajouter aux favoris' : (isFavorite()(pollution.id) ? 'Retirer des favoris' : 'Ajouter aux favoris')"
              (click)="toggleFavorite(pollution); $event.stopPropagation(); $event.preventDefault()">
              {{ isFavorite()(pollution.id) ? '‚≠ê' : '‚òÜ' }}
            </button>
            <a
              [routerLink]="['/pollutions/edit', pollution.id]"
              class="btn-edit"
              (click)="$event.stopPropagation()"
              title="Modifier">
              ‚úèÔ∏è
            </a>
            <button
              appLoadingButton
              [loading]="deleteLoadingId() === pollution.id"
              class="btn-delete"
              (click)="onDelete(pollution.id, $event)"
              title="Supprimer">
              üóëÔ∏è
            </button>
          </div>
        </a>
      } @empty {
        <div class="no-data">Aucune pollution trouv√©e</div>
      }
    </div>
  }
</div>
